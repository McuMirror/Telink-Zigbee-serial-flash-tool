#coding=utf-8
#!/usr/bin/env python

### ComSwireWriter.py ###
###    Autor: pvvx    ###
###    Edited: Aaron Christophel ATCnetz.de    ###
###    Edit : Pila    ###

import sys
import signal
import struct
import serial
import platform
import time
import argparse
import os
import io
import serial.tools.list_ports
import base64

boot_bin = base64.b64decode(b"""
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
""")

def sws_encode_blk(blk):
	pkt=[]
	d = bytearray([0xe8,0xef,0xef,0xef,0xef])
	for el in blk:
		if (el & 0x80) != 0:
			d[0] &= 0x0f
		if (el & 0x40) != 0:
			d[1] &= 0xe8
		if (el & 0x20) != 0:
			d[1] &= 0x0f
		if (el & 0x10) != 0:
			d[2] &= 0xe8
		if (el & 0x08) != 0:
			d[2] &= 0x0f
		if (el & 0x04) != 0:
			d[3] &= 0xe8
		if (el & 0x02) != 0:
			d[3] &= 0x0f
		if (el & 0x01) != 0:
			d[4] &= 0xe8
		pkt += d 
		d = bytearray([0xef,0xef,0xef,0xef,0xef])
	return pkt

# encode command stop into 10-bit swire words
def sws_code_end():
	return sws_encode_blk([0xff])
# encode the command for writing data into 10-bit swire words
def sws_wr_addr(addr, data):
	return sws_encode_blk(bytearray([0x5a, (addr>>16)&0xff, (addr>>8)&0xff, addr & 0xff, 0x00]) + bytearray(data)) + sws_encode_blk([0xff])
# send block to USB-COM
def wr_usbcom_blk(serialPort, blk):
	return serialPort.write(blk)
# send and receive block to USB-COM
def	rd_wr_usbcom_blk(serialPort, blk):
	i = wr_usbcom_blk(serialPort, blk)
	return i == len(serialPort.read(i))
# send swire command write to USB-COM
def sws_wr_addr_usbcom(serialPort, addr, data):
	return wr_usbcom_blk(serialPort, sws_wr_addr(addr, data))
# send and receive swire command write to USB-COM


def activate(serialPort, tact_ms):

	serialPort.setDTR(True)
	serialPort.setRTS(True)
	time.sleep(0.05)
	serialPort.setDTR(False)
	serialPort.setRTS(False)
	# Stop CPU|: [0x0602]=5
	sws_wr_addr_usbcom(serialPort, 0x06f, bytearray([0x20])) # soft reset mcu
	blk = sws_wr_addr(0x0602, bytearray([0x05]))
	if tact_ms > 0:
		tact = tact_ms/1000.0
		t1 = time.time()
		while time.time()-t1 < tact:
			for i in range(5):
				wr_usbcom_blk(serialPort, blk)
			serialPort.reset_input_buffer()
	#--------------------------------
	# Duplication with syncronization
	time.sleep(0.01)
	serialPort.reset_input_buffer()
	rd_wr_usbcom_blk(serialPort, sws_code_end())
	rd_wr_usbcom_blk(serialPort, blk)
	time.sleep(0.01)
	serialPort.reset_input_buffer()

def load_ram(_port):
	size = len(boot_bin)
	addr = 0x40000
	bin_addr = 0
	while size > 0:
		data = boot_bin[bin_addr:bin_addr+0x100]
		if not len(data) > 0: # end of stream
			break
		_port.write(sws_wr_addr(addr, data))
		_port.reset_input_buffer()
		bin_addr += len(data)
		addr += len(data)
		size -= len(data)

	# print('\rBin bytes writen:', bin_addr)		
	# print('CPU go Start...')
	_port.write(sws_wr_addr(0x0602, b'\x88')) # cpu go Start
	time.sleep(0.07)
	_port.flushInput()
	_port.flushOutput()
	_port.reset_input_buffer()
	_port.reset_output_buffer()
	time.sleep(0.07)
	return True

def uart_boot(serialPort):
	activate(serialPort, 80)
	return load_ram(serialPort)
