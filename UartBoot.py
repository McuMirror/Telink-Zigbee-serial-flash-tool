#coding=utf-8
#!/usr/bin/env python

### ComSwireWriter.py ###
###    Autor: pvvx    ###
###    Edited: Aaron Christophel ATCnetz.de    ###
###    Edit : Pila    ###

import sys
import signal
import struct
import serial
import platform
import time
import argparse
import os
import io
import serial.tools.list_ports
import base64

boot_bin = base64.b64decode(b"""
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
""")

def sws_encode_blk(blk):
	pkt=[]
	d = bytearray([0xe8,0xef,0xef,0xef,0xef])
	for el in blk:
		if (el & 0x80) != 0:
			d[0] &= 0x0f
		if (el & 0x40) != 0:
			d[1] &= 0xe8
		if (el & 0x20) != 0:
			d[1] &= 0x0f
		if (el & 0x10) != 0:
			d[2] &= 0xe8
		if (el & 0x08) != 0:
			d[2] &= 0x0f
		if (el & 0x04) != 0:
			d[3] &= 0xe8
		if (el & 0x02) != 0:
			d[3] &= 0x0f
		if (el & 0x01) != 0:
			d[4] &= 0xe8
		pkt += d 
		d = bytearray([0xef,0xef,0xef,0xef,0xef])
	return pkt

# encode command stop into 10-bit swire words
def sws_code_end():
	return sws_encode_blk([0xff])
# encode the command for writing data into 10-bit swire words
def sws_wr_addr(addr, data):
	return sws_encode_blk(bytearray([0x5a, (addr>>16)&0xff, (addr>>8)&0xff, addr & 0xff, 0x00]) + bytearray(data)) + sws_encode_blk([0xff])
# send block to USB-COM
def wr_usbcom_blk(serialPort, blk):
	return serialPort.write(blk)
# send and receive block to USB-COM
def	rd_wr_usbcom_blk(serialPort, blk):
	i = wr_usbcom_blk(serialPort, blk)
	return i == len(serialPort.read(i))
# send swire command write to USB-COM
def sws_wr_addr_usbcom(serialPort, addr, data):
	return wr_usbcom_blk(serialPort, sws_wr_addr(addr, data))
# send and receive swire command write to USB-COM


def activate(serialPort, tact_ms):

	serialPort.setDTR(True)
	serialPort.setRTS(True)
	time.sleep(0.05)
	serialPort.setDTR(False)
	serialPort.setRTS(False)
	# Stop CPU|: [0x0602]=5
	sws_wr_addr_usbcom(serialPort, 0x06f, bytearray([0x20])) # soft reset mcu
	blk = sws_wr_addr(0x0602, bytearray([0x05]))
	if tact_ms > 0:
		tact = tact_ms/1000.0
		t1 = time.time()
		while time.time()-t1 < tact:
			for i in range(5):
				wr_usbcom_blk(serialPort, blk)
			serialPort.reset_input_buffer()
	#--------------------------------
	# Duplication with syncronization
	time.sleep(0.01)
	serialPort.reset_input_buffer()
	rd_wr_usbcom_blk(serialPort, sws_code_end())
	rd_wr_usbcom_blk(serialPort, blk)
	time.sleep(0.01)
	serialPort.reset_input_buffer()

def load_ram(_port):
	size = len(boot_bin)
	addr = 0x40000
	bin_addr = 0
	while size > 0:
		data = boot_bin[bin_addr:bin_addr+0x100]
		if not len(data) > 0: # end of stream
			break
		_port.write(sws_wr_addr(addr, data))
		_port.reset_input_buffer()
		bin_addr += len(data)
		addr += len(data)
		size -= len(data)

	# print('\rBin bytes writen:', bin_addr)		
	# print('CPU go Start...')
	_port.write(sws_wr_addr(0x0602, b'\x88')) # cpu go Start
	time.sleep(0.07)
	_port.flushInput()
	_port.flushOutput()
	_port.reset_input_buffer()
	_port.reset_output_buffer()
	time.sleep(0.07)
	return True

def uart_boot(serialPort):
	activate(serialPort, 80)
	return load_ram(serialPort)
